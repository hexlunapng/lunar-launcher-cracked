const{ipcRenderer:ipcRenderer}=require("electron"),{exec:exec}=require("child_process");let currentUser=null,currentTab="home";const builds=[],runningGames=new Map;let isPackaged=!1;const assetMap={logo:"logo.png","logo-large":"logo-large.png","luxor-logo":"LuxorNewLogoV1.png",vbucks:"vbucks-icon.png",hype:"hype.png",level:"level-icon.png",crown:"crown-icon.png","user-avatar":"user-avatar.png","news-banner":"news-banner.jpg","treasure-hunt":"treasure-hunt.jpg"};async function getImagePath(e){try{const t=assetMap[e]||e,n=await ipcRenderer.invoke("get-asset-path",t);return n.success?`file://${n.path.replace(/\\/g,"/")}`:(console.warn(`Asset not found: ${t}`),null)}catch(e){return console.error("Error getting image path:",e),null}}async function loadImageWithFallback(e,t,n){if(!e)return;const a=await getImagePath(t);a?(e.src=a,e.style.display="block",e.onload=()=>{console.log(`✅ Loaded image: ${t}`),n&&(n.style.display="none")},e.onerror=()=>{console.warn(`❌ Failed to load image: ${t}`),e.style.display="none",n&&(n.style.display="flex")}):(e.style.display="none",n&&(n.style.display="flex"))}async function initializeApp(){isPackaged=await ipcRenderer.invoke("is-packaged"),console.log("🚀 App is packaged:",isPackaged);const e=await ipcRenderer.invoke("get-all-assets");e.success&&(console.log("📁 Available assets:",e.assets),console.log("📂 Assets path:",e.path)),setTimeout(()=>{document.body.removeAttribute("data-loading"),document.body.classList.remove("app-loading")},500),loadSavedCredentials(),setupNavigation(),loadBuilds(),setupWindowControls(),setupEventListeners(),setupAnimations(),createFloatingBackground(),await loadAllLauncherAssets(),currentUser&&setInterval(async()=>{updateStatsDisplay(await fetchUserStats(currentUser.displayName))},3e5)}async function handleLogin(e){e.preventDefault();const t=document.getElementById("email").value,n=document.getElementById("password").value,a=document.getElementById("loginButton"),o=document.getElementById("loginText"),s=document.getElementById("loginSpinner"),i=document.getElementById("errorMessage");i.textContent="",i.classList.add("hidden"),a.disabled=!0,o.style.opacity="0",s.classList.remove("hidden");try{const e=await ipcRenderer.invoke("login-api",{email:t,password:n});if(!e.success)throw new Error(e.error||"Login failed");{const a=e.data||{},o=a.username||a.displayName||a.name||t.split("@")[0];currentUser={email:t,password:n,username:o,displayName:o,...a};updateStatsDisplay(await fetchUserStats(o)),document.getElementById("userName").textContent=o,document.getElementById("settingsUserName").textContent=o;const s=document.querySelector(".current-user-avatar");s&&await loadImageWithFallback(s,"user-avatar"),document.getElementById("rememberMe").checked&&localStorage.setItem("lunar-credentials",JSON.stringify({email:t,password:n,username:o,displayName:o})),setTimeout(()=>{document.getElementById("loginScreen").style.opacity="0",document.getElementById("loginScreen").style.transform="scale(0.95)",setTimeout(()=>{document.getElementById("loginScreen").classList.add("hidden"),document.getElementById("mainLauncher").classList.remove("hidden"),document.getElementById("mainLauncher").style.opacity="1",document.getElementById("mainLauncher").style.transform="scale(1)"},500)},1e3)}}catch(e){console.error("Login error:",e),i.textContent=e.message,i.classList.remove("hidden"),a.style.animation="shake 0.5s ease-in-out",setTimeout(()=>{a.style.animation=""},500)}finally{a.disabled=!1,o.style.opacity="1",s.classList.add("hidden")}}async function launchBuild(e){if(currentUser)try{const t=await ipcRenderer.invoke("launch-fortnite-with-dll",{buildPath:e.path,credentials:{email:currentUser.email,password:currentUser.password}});if(!t.success)throw new Error(t.error||"Launch failed");{runningGames.set(e.id,{processId:t.processId,buildName:e.name,startTime:Date.now()}),renderBuilds();const n=()=>{runningGames.delete(e.id),renderBuilds(),ipcRenderer.removeListener(`game-process-exit-${e.id}`,n)};ipcRenderer.on(`game-process-exit-${e.id}`,n)}}catch(e){console.error("Launch error:",e),showToast(`Failed to launch: ${e.message}`,"error")}else showToast("Please login first","error")}function showToast(e,t="info"){const n=document.getElementById("toast"),a=document.getElementById("toastMessage");if(n&&a){n.classList.remove("toast-info","toast-success","toast-error","toast-warning"),n.classList.add(`toast-${t}`),a.textContent=e,n.classList.add("show");setTimeout(()=>{n.classList.remove("show")},"error"===t?5e3:3e3)}else console.log(`Toast (${t}):`,e)}async function loadAllLauncherAssets(){console.log("🔄 Loading launcher assets...");const e=document.querySelectorAll(".main-logo, .launcher-logo, [data-logo]");for(const t of e)await loadImageWithFallback(t,"luxor-logo");const t=document.querySelectorAll('.vbucks-icon, [data-asset="vbucks"]');for(const e of t)await loadImageWithFallback(e,"vbucks");const n=document.querySelectorAll('.hype-icon, [data-asset="hype"]');for(const e of n)await loadImageWithFallback(e,"hype");const a=document.querySelectorAll('.level-icon, [data-asset="level"]');for(const e of a)await loadImageWithFallback(e,"level");console.log("✅ All launcher assets loaded!")}document.addEventListener("DOMContentLoaded",()=>{initializeApp()});const enhancedStyles=document.createElement("style");function setLaunchState(e){const t=document.querySelector("#build-card");t&&(t.classList.toggle("running",e),t.disabled=e)}function checkIfAnyFortniteProcessRunning(){return new Promise(e=>{exec("tasklist /FO CSV",(t,n)=>{if(t||!n)return e(!1);const a=n.toLowerCase();e(["FortniteClient-Win64-Shipping.exe","FortniteLauncher.exe","FortniteClient-Win64-Shipping_EAC.exe","FortniteClient-Win64-Shipping_BE.exe"].some(e=>a.includes(e.toLowerCase())))})})}async function fetchUserStats(e){return{level:Math.floor(100*Math.random()),vbucks:Math.floor(1e4*Math.random()),hype:Math.floor(5e3*Math.random()),crowns:Math.floor(10*Math.random())}}function updateStatsDisplay(e){document.getElementById("levelValue").textContent=e.level,document.getElementById("vbucksValue").textContent=e.vbucks,document.getElementById("hypeValue").textContent=e.hype,document.getElementById("crownsValue").textContent=e.crowns}function setupNavigation(){document.querySelectorAll(".nav-link").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();switchTab(e.getAttribute("data-tab"))})})}function switchTab(e){currentTab=e;document.querySelectorAll(".tab-content").forEach(e=>{e.classList.add("hidden")}),document.getElementById(e).classList.remove("hidden")}function loadSavedCredentials(){const e=localStorage.getItem("lunar-credentials");if(e){const t=JSON.parse(e);document.getElementById("email").value=t.email,document.getElementById("password").value=t.password,document.getElementById("rememberMe").checked=!0}}function loadBuilds(){builds.push({id:"build1",name:"Fortnite Build 1",path:"/path/to/build1",version:"1.0"}),builds.push({id:"build2",name:"Fortnite Build 2",path:"/path/to/build2",version:"2.0"}),renderBuilds()}function renderBuilds(){const e=document.getElementById("buildsContainer");e.innerHTML="",builds.forEach(t=>{const n=runningGames.has(t.id),a=document.createElement("div");a.classList.add("build-card"),n&&a.classList.add("game-running"),a.innerHTML=`\n            <h3>${t.name}</h3>\n            <p>Version: ${t.version}</p>\n            <button onclick="launchBuild(${JSON.stringify(t).replace(/"/g,"&quot;")})" ${n?"disabled":""}>\n                ${n?"Running...":"Launch"}\n            </button>\n        `,e.appendChild(a)})}function isFortniteShippingRunning(){return new Promise(e=>{exec('tasklist /FI "IMAGENAME eq FortniteClient-Win64-Shipping.exe" /FO CSV',(t,n)=>{if(t||!n)return e(!1);e(n.includes("FortniteClient-Win64-Shipping.exe"))})})}function setLaunchState(e){const t=document.querySelector("#build-card");t&&(t.classList.toggle("running",e),t.disabled=e)}function setupWindowControls(){document.getElementById("closeButton").addEventListener("click",()=>{ipcRenderer.send("close-window")}),document.getElementById("minimizeButton").addEventListener("click",()=>{ipcRenderer.send("minimize-window")})}function setupEventListeners(){document.getElementById("loginForm").addEventListener("submit",handleLogin)}function setupAnimations(){}function createFloatingBackground(){}enhancedStyles.textContent+='\n  /* Bouton launch */\n  .launch-btn {\n    position: relative;\n    transition: transform .2s ease, opacity .2s ease;\n  }\n  .launch-btn.running {\n    pointer-events: none;\n    opacity: .8;\n  }\n  .launch-btn.running::after {\n    content: "🚀 Launching…";\n    position: absolute;\n    inset: -2px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-weight: 600;\n    letter-spacing: .3px;\n    backdrop-filter: blur(3px);\n    -webkit-backdrop-filter: blur(3px);\n    border-radius: inherit;\n  }\n',document.head.appendChild(enhancedStyles),document.querySelector("#build-card")?.addEventListener("click",()=>{setLaunchState(!0)}),ipcRenderer.on("game-status",(e,{running:t})=>setLaunchState(t)),(async()=>{try{const e=await ipcRenderer.invoke("is-game-running");setLaunchState(e)}catch{}})(),ipcMain.handle("is-game-running",async()=>{try{return await checkIfAnyFortniteProcessRunning()}catch{return!1}}),window.togglePassword=()=>{const e=document.getElementById("password"),t=document.querySelector(".password-toggle svg");"password"===e.type?(e.type="text",t.innerHTML='<path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/>'):(e.type="password",t.innerHTML='<path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>')},ipcMain.handle("is-game-running",async()=>await isFortniteShippingRunning()),document.querySelector("#build-card")?.addEventListener("click",()=>{setLaunchState(!0)}),ipcRenderer.on("game-status",(e,{running:t})=>setLaunchState(t)),(async()=>{const e=await ipcRenderer.invoke("is-game-running");setLaunchState(e)})(),console.log("🚀 Enhanced Renderer Script Loaded"),console.log("✅ Fixed file locking issues"),console.log("✅ Enhanced error handling"),console.log("✅ Improved authentication stability");